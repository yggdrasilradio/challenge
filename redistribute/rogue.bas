1WIDTH80:POKE&HFFD9,0:CLEAR3000:X=RND(-TIMER):ONBRKGOTO1000
10CLS:PRINT"Generating maze";:MW=19:MH=11:DIMA$(MH*2+1):R1$="+":R2$="!":FORI=1TO MW:R1$=R1$+"---+":R2$=R2$+" X !":NEXTI:FORI=1TO MH*2+1:IFI AND1 THENA$(I)=R1$ ELSEA$(I)=R2$
11NEXTI:DIMSX(MW*MH+1),SY(MW*MH+1):S=1:N=MW*MH-1:SX(S)=3:SY(S)=2:MID$(A$(2),3,1)=" "
20PRINT".";:X=SX(S):Y=SY(S):GOSUB3000:IFLEN(R$)=0 THENS=S-1:GOTO20
21D=VAL(MID$(R$,RND(LEN(R$)),1)):OND GOTO22,24,26,28
22Y=Y-2:MID$(A$(Y+1),X-1,3)="   ":GOTO30
24Y=Y+2:MID$(A$(Y-1),X-1,3)="   ":GOTO30
26X=X-4:MID$(A$(Y),X+2,1)=" ":GOTO30
28X=X+4:MID$(A$(Y),X-2,1)=" "
30S=S+1:SX(S)=X:SY(S)=Y:MID$(A$(Y),X,1)=" ":N=N-1:IFN>0 THENGOTO20
31FORI=1TO10
40X=RND(MW):Y=RND(MH):IFMID$(A$(Y*2),X*4-1,1)=" " THENMID$(A$(Y*2),X*4-1,1)="$" ELSEGOTO40
41NEXTI:FORI=1TO4
50X=RND(MW):Y=RND(MH):IFMID$(A$(Y*2),X*4-1,1)=" " THENMID$(A$(Y*2),X*4-1,1)="^" ELSEGOTO50
51NEXTI:CLS:FORI=1TO MH*2+1:PRINTA$(I):NEXTI:S=0:LOCATE0,23:PRINT"GOLD: 0";:X=3:Y=2:LOCATEX-1,Y-1:PRINT"O";:DIMX(2),Y(2),DX(2),DY(2):FORI=1TO2:READX(I),Y(I),DX(I),DY(I):LOCATEX(I)-1,Y(I)-1:PRINT"&";:NEXTI
52I$=""
100S$=INKEY$:IFS$="" THENGOTO100
101M$="                 ":GOSUB9000:I=ASC(S$):NX=X:NY=Y:IFI=94 THENNY=NY-1
102IFI=10 THENNY=NY+1
103IFI=8 THENNX=NX-2
104IFI=9 THENNX=NX+2
105C$=MID$(A$(NY),NX,1):IFC$="$" THENS=S+10:LOCATE0,23:PRINT"GOLD:";S;:MID$(A$(NY),NX,1)=" ":M$="FOUND GOLD":GOSUB9000
106IFC$="^" THENI$="^":MID$(A$(NY),NX,1)=" ":M$="FOUND SWORD":GOSUB9000
107IFINSTR("!+-",C$)=0 THENLOCATEX-1,Y-1:PRINT" ";:LOCATENX-1,NY-1:PRINT"O";:X=NX:Y=NY
108IFS=100 THENGOSUB6000
109GOSUB2000:GOTO100
1000POKE&H71,0:EXEC&H8C1B
2000FORI=1TO2:MX=X(I):MY=Y(I):IFMX>0 THENGOSUB8000
2001IFX=X(I)AND Y=Y(I) THENGOSUB7000
2002NEXTI:RETURN
3000R$=""
3010IFY=2 THENGOTO3030
3011NY=Y-2:IFMID$(A$(NY),X,1)<>" "AND MID$(A$(Y-1),X,1)<>" " THENR$=R$+"1"
3030IFY=MH*2 THENGOTO3040
3031NY=Y+2:IFMID$(A$(NY),X,1)<>" "AND MID$(A$(Y+1),X,1)<>" " THENR$=R$+"2"
3040IFX=3 THENGOTO3050
3041NX=X-4:IFMID$(A$(Y),NX,1)<>" "AND MID$(A$(Y),X-2,1)<>" " THENR$=R$+"3"
3050IFX=4*MW-1 THENGOTO3060
3051NX=X+4:IFMID$(A$(Y),NX,1)<>" "AND MID$(A$(Y),X+2,1)<>" " THENR$=R$+"4"
3060RETURN
4000ONRND(4)GOTO4010,4020,4030,4040
4010DX(I)=0:DY(I)=1:GOTO4050
4020DX(I)=2:DY(I)=0:GOTO4050
4030DX(I)=0:DY(I)=-1:GOTO4050
4040DX(I)=-2:DY(I)=0
4050NX=MX+DX(I):NY=MY+DY(I):C$=MID$(A$(NY),NX,1):IFINSTR("!+-",C$)>0 THENGOTO4000
4051RETURN
5000IFMX<>X AND MY<>Y THENRETURN
5001DX=0:DY=0:IFMX=X AND MY<Y THENDY=1
5002IFMX=X AND MY>Y THENDY=-1
5003IFMY=Y AND MX<X THENDX=2
5004IFMY=Y AND MX>X THENDX=-2
5005NX=MX:NY=MY
5010NX=NX+DX:NY=NY+DY:C$=MID$(A$(NY),NX,1):IFINSTR("!+-",C$)>0 THENRETURN
5011IFNX<>X OR NY<>Y THENGOTO5010
5012DX(I)=DX:DY(I)=DY:RETURN
6000M$="YOU HAVE WON!":GOSUB9000
6020S$=INKEY$:IFS$="" THENGOTO6020
6021RUN
7000LOCATEX-1,Y-1:IFI$="^" THENI$="":X(I)=0:M$="KILLED DRAGON":GOSUB9000:LOCATEX-1,Y-1:PRINT"O";:RETURN
7001LOCATEX-1,Y-1:PRINT"&";:M$="YOU DIED":GOSUB9000
7020S$=INKEY$:IFS$="" THENGOTO7020
7021RUN
8000NX=MX+DX(I):NY=MY+DY(I):C$=MID$(A$(NY),NX,1):IFINSTR("!+-",C$)>0 THENGOSUB4000
8001X(I)=NX:Y(I)=NY:LOCATEMX-1,MY-1:PRINTMID$(A$(MY),MX,1);:IFI$=""OR NX<>X OR NY<>Y THENLOCATENX-1,NY-1:PRINT"&";
8002MX=X(I):MY=Y(I):GOSUB5000:RETURN
9000LOCATELEN(A$(1))-LEN(M$),23:PRINTM$;:RETURN
9001DATA23,2,2,0,23,14,-2,0
